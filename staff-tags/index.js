(function(B,C,s,l,p,u,f,S,R){"use strict";const{Permissions:v}=l.constants,{computePermissions:T}=s.findByProps("computePermissions","canEveryoneRole"),N=s.findByStoreName("GuildMemberStore"),y=[l.i18n.Messages.AI_TAG,l.i18n.Messages.BOT_TAG_SERVER,l.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,l.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,l.i18n.Messages.REMIXING_TAG],_=[{text:"WEBHOOK",condition:function(t,o,r){return r.isNonUserBot()}},{text:"OWNER",backgroundColor:u.rawColors.ORANGE_345,condition:function(t,o,r){return t?.ownerId===r.id}},{text:l.i18n.Messages.BOT_TAG_BOT,condition:function(t,o,r){return r.bot},verified:function(t,o,r){return r.isVerifiedBot()}},{text:"ADMIN",backgroundColor:u.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:u.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:u.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function E(t,o,r){let a;if(t){const e=T({user:r,context:t,overwrites:o?.permissionOverwrites});a=Object.entries(v).map(function([n,i]){return e&i?n:""}).filter(Boolean)}for(const e of _)if(e.condition?.(t,o,r)||e.permissions?.some(function(n){return a?.includes(n)})){let n=C.storage.useRoleColor?N.getMember(t?.id,r.id)?.colorString:void 0,i=n||(e.backgroundColor??u.rawColors.BRAND_500),c=n||!e.textColor?l.chroma(i).get("lab.l")<70?u.rawColors.WHITE_500:u.rawColors.BLACK_500:e.textColor;return{...e,textColor:c,backgroundColor:i,verified:typeof e.verified=="function"?e.verified(t,o,r):e.verified??!1,condition:void 0,permissions:void 0}}}const G=s.findByName("getTagProperties",!1),A=s.findByStoreName("GuildStore"),M=s.findByStoreName("ChannelStore");function I(){return p.after("default",G,function([{message:t}],o){if(!y.includes(o.tagText)){const r=M.getChannel(t.channel_id),a=A.getGuild(r?.guild_id),e=E(a,r,t.author);if(e)return{...o,tagText:e.text,tagTextColor:e.textColor?l.ReactNative.processColor(l.chroma(e.textColor).hex()):void 0,tagBackgroundColor:e.backgroundColor?l.ReactNative.processColor(l.chroma(e.backgroundColor).hex()):void 0,tagVerified:e.verified,tagType:void 0}}})}const h=s.findByProps("getBotLabel"),k=h.getBotLabel,w=s.findByStoreName("GuildStore"),O=function([{guildId:t,user:o}],r){const a=f.findInReactTree(r.props.label,function(e){return e.type.Types});if(!a||!y.includes(k(a.props.type))){const e=w.getGuild(t),n=E(e,void 0,o);if(n)if(a)a.props={type:0,...n};else{const i=f.findInReactTree(r.props.label,function(c){return c.props?.lineClamp});if(i){const c=i.props.children;c?.props?.children&&(c.props.children[1]=React.createElement(React.Fragment,null," ",React.createElement(h.default,{type:0,text:n.text,textColor:n.textColor,backgroundColor:n.backgroundColor,verified:n.verified})))}}}};function m(){const t=[];return s.findByTypeNameAll("UserRow").forEach(function(o){return t.push(p.after("type",o,O))}),function(){return t.forEach(function(o){return o()})}}const L=s.findByName("DisplayName",!1),D=s.findByName("HeaderName",!1),x=s.findByProps("getBotLabel"),$=x.getBotLabel,P=s.findByStoreName("GuildStore"),U=s.findByStoreName("ChannelStore");function H(){const t=[];return t.push(p.after("default",D,function([{channelId:o}],r){r.props.channelId=o})),t.push(p.after("default",L,function([{guildId:o,channelId:r,user:a}],e){const n=f.findInReactTree(e,function(i){return i.type.Types});if(!n||!y.includes($(n.props.type))){const i=P.getGuild(o),c=U.getChannel(r),d=E(i,c,a);d&&(n?n.props={type:0,...d}:f.findInReactTree(e,function(Z){return Z.props.style.flexDirection==="row"}).props.children.push(React.createElement(x.default,{style:{marginLeft:0},type:0,text:d.text,textColor:d.textColor,backgroundColor:d.backgroundColor,verified:d.verified})))}})),function(){return t.forEach(function(o){return o()})}}const K=s.findByProps("GuildMemberRow"),b=s.findByProps("getBotLabel"),V=b.getBotLabel,F=s.findByStoreName("GuildStore");function W(){return p.after("type",K.GuildMemberRow,function([{guildId:t,channel:o,user:r}],a){const e=f.findInReactTree(a,function(n){return n.type.Types});if(!e||!y.includes(V(e.props.type))){const n=F.getGuild(t),i=E(n,o,r);if(i)if(e)e.props={type:0,...i};else{const c=f.findInReactTree(a,function(d){return d.props.style?.flexDirection==="row"});c&&c.props.children&&c.props.children.splice(2,0,React.createElement(b.default,{type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified}))}}})}const j=s.findByProps("getBotLabel");function X(){return p.after("default",j,function([{text:t,textColor:o,backgroundColor:r}],a){const e=f.findInReactTree(a,function(n){return typeof n.props.children=="string"});t&&(e.props.children=t),o&&e.props.style.push({color:o}),r&&a.props.style.push({backgroundColor:r})})}const{ScrollView:Y}=R.General,{FormSection:q,FormSwitchRow:z}=R.Forms;function J(){return S.useProxy(C.storage),React.createElement(Y,{style:{flex:1}},React.createElement(q,{title:"Tag style"},React.createElement(z,{label:"Use top role color for tag backgrounds",value:C.storage.useRoleColor,onValueChange:function(t){C.storage.useRoleColor=t}})))}let g=[];var Q={onLoad:function(){C.storage.useRoleColor??=!1,g.push(I()),g.push(X()),g.push(H()),g.push(W()),g.push(m())},onUnload:function(){return g.forEach(function(t){return t()})},settings:J};return B.default=Q,Object.defineProperty(B,"__esModule",{value:!0}),B})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
